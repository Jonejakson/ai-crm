# Настройка SSH ключа для подключения к серверу Selectel (Windows)

## Вариант 1: Использование существующего ключа

Если у вас уже есть SSH ключ, найдите его:

### Проверка существующих ключей

Откройте PowerShell и выполните:

```powershell
# Проверка папки .ssh
dir $env:USERPROFILE\.ssh

# Просмотр всех публичных ключей
Get-ChildItem $env:USERPROFILE\.ssh\*.pub
```

Если видите файлы типа `id_ed25519.pub` или `id_rsa.pub`, скопируйте содержимое:

```powershell
# Для ed25519 ключа
Get-Content $env:USERPROFILE\.ssh\id_ed25519.pub | Set-Clipboard

# Или для rsa ключа
Get-Content $env:USERPROFILE\.ssh\id_rsa.pub | Set-Clipboard
```

Содержимое будет скопировано в буфер обмена.

---

## Вариант 2: Создание нового SSH ключа

Если ключа нет, создайте новый:

### Шаг 1: Создание ключа

Откройте PowerShell и выполните:

```powershell
# Создание ed25519 ключа (рекомендуется)
ssh-keygen -t ed25519 -C "your_email@example.com" -f "$env:USERPROFILE\.ssh\id_ed25519"

# Или создание RSA ключа (если ed25519 не поддерживается)
ssh-keygen -t rsa -b 4096 -C "your_email@example.com" -f "$env:USERPROFILE\.ssh\id_rsa"
```

**Примечание:** При запросе пароля можете нажать Enter (без пароля) или ввести пароль для дополнительной безопасности.

### Шаг 2: Копирование публичного ключа

```powershell
# Для ed25519
Get-Content $env:USERPROFILE\.ssh\id_ed25519.pub | Set-Clipboard

# Или для rsa
Get-Content $env:USERPROFILE\.ssh\id_rsa.pub | Set-Clipboard
```

Содержимое скопировано в буфер обмена.

---

## Шаг 3: Добавление ключа в панель Selectel

1. **Откройте панель управления Selectel:**
   - Перейдите на https://panel.selectel.com
   - Войдите в аккаунт

2. **Перейдите к серверу:**
   - Нажмите на вкладку **"СЕРВЕРЫ"**
   - Выберите сервер **"flame-prod"**

3. **Добавьте SSH ключ:**
   - В разделе **"SSH-keys for root user"**
   - Нажмите **"Добавить новый или выбрать существующий"**
   - Вставьте скопированный публичный ключ (Ctrl+V)
   - Или выберите существующий ключ `local-ed25519`, если он уже есть

4. **Сохраните изменения**

---

## Шаг 4: Подключение к серверу

### Способ 1: Использование SSH команды

Откройте PowerShell или Command Prompt и выполните:

```bash
ssh root@79.143.30.96
```

При первом подключении подтвердите добавление хоста (введите `yes`).

### Способ 2: Использование PuTTY (альтернатива)

Если у вас установлен PuTTY:

1. Откройте PuTTY
2. В поле **Host Name** введите: `root@79.143.30.96`
3. В разделе **Connection > SSH > Auth** укажите путь к приватному ключу:
   - `C:\Users\ВашеИмя\.ssh\id_ed25519` (или `id_rsa`)
4. Нажмите **Open**

---

## Шаг 5: Проверка подключения

После успешного подключения вы должны увидеть приглашение командной строки сервера:

```bash
root@flame-prod:~#
```

Теперь вы можете выполнять команды на сервере!

---

## Полезные команды SSH

```bash
# Подключение с указанием ключа явно
ssh -i ~/.ssh/id_ed25519 root@79.143.30.96

# Подключение с выводом отладочной информации
ssh -v root@79.143.30.96

# Копирование файла на сервер
scp file.txt root@79.143.30.96:/opt/

# Копирование файла с сервера
scp root@79.143.30.96:/opt/file.txt ./
```

---

## Устранение проблем

### Проблема: "Permission denied (publickey)"

**Решение:**
1. Убедитесь, что публичный ключ добавлен в панель Selectel
2. Проверьте права доступа к приватному ключу:
   ```powershell
   icacls $env:USERPROFILE\.ssh\id_ed25519
   ```
3. Если нужно, установите права:
   ```powershell
   icacls $env:USERPROFILE\.ssh\id_ed25519 /inheritance:r
   icacls $env:USERPROFILE\.ssh\id_ed25519 /grant:r "$env:USERNAME:(R)"
   ```

### Проблема: "Host key verification failed"

**Решение:**
Удалите старую запись из known_hosts:
```powershell
ssh-keygen -R 79.143.30.96
```

### Проблема: SSH ключ не работает

**Решение:**
1. Проверьте, что ключ добавлен в панель Selectel
2. Убедитесь, что используете правильный приватный ключ
3. Попробуйте подключиться с явным указанием ключа:
   ```bash
   ssh -i C:\Users\ВашеИмя\.ssh\id_ed25519 root@79.143.30.96
   ```

---

## Быстрая команда для копирования ключа

Если вы используете ed25519 ключ, выполните в PowerShell:

```powershell
Get-Content $env:USERPROFILE\.ssh\id_ed25519.pub | Set-Clipboard; Write-Host "Публичный ключ скопирован в буфер обмена!"
```

Затем вставьте его в панель Selectel (Ctrl+V).


