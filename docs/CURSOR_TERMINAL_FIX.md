# Почему агент не может выполнять git/ssh в терминале Cursor

## Что значит «в этой среде»

**«В этой среде»** — это встроенный терминал Cursor, в котором запускаются команды, когда агент (я) нажимает «Run» или выполняет команды за тебя.

В этой среде по умолчанию:

1. **Песочница (sandbox)** — ограничивает доступ к сети и иногда к папкам вне проекта (в т.ч. к `.git`).
2. **Обёртка PowerShell** — перед каждой командой Cursor запускает свой скрипт; у тебя он падает на `Get-ChildItem Env:` (возможно из‑за «битой» переменной окружения).

Из‑за этого:
- `git commit` / `git push` — «Permission denied» на `.git/index.lock`;
- `ssh` — команда не выполняется или «Network access: Blocked».

Вчера могло работать, если: песочница была отключена, стоял другой режим терминала или обновление Cursor изменило поведение.

---

## Что уже сделано в настройках

В твой **Cursor User settings** добавлено:

- **`cursor.chat.sandboxEnabled": false`** — отключить песочницу для команд из чата (агент сможет использовать сеть и писать в `.git`).
- **`cursor.terminal.enableLegacyMode": true`** — использовать старый режим терминала (часто ведёт себя предсказуемее).

Файл: `%APPDATA%\Cursor\User\settings.json`  
(полный путь: `C:\Users\mallo\AppData\Roaming\Cursor\User\settings.json`).

**После изменения настроек:** закрой Cursor полностью и открой снова, затем попроси агента снова выполнить `git` или `ssh`.

---

## Если после этого всё равно не работает

### 1. Ошибка `Get-ChildItem Env:`

Она идёт из скрипта Cursor, который перебирает переменные окружения. Часто виновата одна «плохая» переменная (например, с нестандартным именем или символом).

Что сделать:

- Открой **PowerShell** (не в Cursor) и выполни:
  ```powershell
  Get-ChildItem Env: | Sort-Object Name
  ```
- Если команда упадёт — смотри, на какой переменной остановилась; можно временно переименовать/удалить её в «Переменные среды» (Win → «переменные среды» → «Изменить переменные среды»).

### 2. Разрешения при запуске команд

Когда агент запускает команду, Cursor может показать запрос **«Allow terminal commands»** (или похожий). Выбирай **«Always»** или **«Allow»**, чтобы команды выполнялись без лишних блокировок.

### 3. Ручной запуск в своём терминале

Если в Cursor по‑прежнему не работает:

- Открой **обычный терминал** (PowerShell/cmd) **вне Cursor** или встроенный терминал Cursor (Ctrl+`) и выполняй `git` и `ssh` сам.
- Либо попроси агента только **написать тебе команды**, а запускать будешь ты.

---

## Кратко

| Что сделать | Зачем |
|-------------|--------|
| Перезапустить Cursor после смены настроек | Чтобы применились `cursor.chat.sandboxEnabled` и `cursor.terminal.enableLegacyMode`. |
| При запросе «Allow terminal commands» выбирать Always/Allow | Чтобы команды агента не блокировались. |
| Проверить `Get-ChildItem Env:` в обычном PowerShell | Найти переменную, из‑за которой падает обёртка Cursor. |
| Выполнять git/ssh вручную в своём терминале | Если в среде Cursor по‑прежнему ограничения. |

После этого агент снова сможет выполнять git и ssh «в этой среде», как вчера, если причина была в песочнице и режиме терминала.
