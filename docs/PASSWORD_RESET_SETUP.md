# Настройка восстановления пароля

## Текущие настройки SMTP на сервере

На сервере уже настроен SMTP для отправки писем:

```
MAIL_HOST=smtp.mail.ru
MAIL_PORT=465
MAIL_USER=info@flamecrm.ru
MAIL_PASSWORD=oLn05BfskIxWZSE2zcWi
MAIL_FROM=info@flamecrm.ru
NEXTAUTH_URL=https://flamecrm.ru
```

## Как работает восстановление пароля

1. Пользователь нажимает "Забыли пароль?" на странице входа
2. Вводит email на странице `/forgot-password`
3. Система генерирует токен и сохраняет его в базе данных
4. Отправляет письмо с ссылкой на `/reset-password?token=...`
5. Пользователь переходит по ссылке и вводит новый пароль
6. Пароль обновляется, токен удаляется

## Безопасность

- Токен действителен 24 часа
- Токен одноразовый (удаляется после использования)
- Защита от перебора email'ов (всегда возвращается успех)
- Валидация пароля (минимум 6 символов)

## Проверка работы

1. Откройте `https://flamecrm.ru/login`
2. Нажмите "Забыли пароль?"
3. Введите email пользователя
4. Проверьте почту (включая папку "Спам")
5. Перейдите по ссылке из письма
6. Введите новый пароль

## Если письма не приходят

1. Проверьте настройки SMTP в `.env`:
   - `MAIL_HOST` - SMTP сервер
   - `MAIL_PORT` - порт (обычно 465 для SSL или 587 для TLS)
   - `MAIL_USER` - логин SMTP
   - `MAIL_PASSWORD` - пароль SMTP
   - `MAIL_FROM` - адрес отправителя
   - `NEXTAUTH_URL` - URL приложения (для ссылок в письмах)

2. Проверьте логи приложения:
   ```bash
   docker-compose logs app | grep -i email
   ```

3. В режиме разработки токен возвращается в ответе API (если SMTP не настроен)

## Настройка нового SMTP провайдера

### Mail.ru (текущий)
- Host: `smtp.mail.ru`
- Port: `465` (SSL) или `587` (TLS)
- User: ваш email на mail.ru
- Password: пароль приложения (не основной пароль!)

### Gmail
- Host: `smtp.gmail.com`
- Port: `465` (SSL) или `587` (TLS)
- User: ваш Gmail адрес
- Password: пароль приложения (нужно включить 2FA и создать пароль приложения)

### Yandex
- Host: `smtp.yandex.ru`
- Port: `465` (SSL) или `587` (TLS)
- User: ваш email на yandex.ru
- Password: пароль приложения (нужно включить в настройках почты)

### Другие провайдеры
Используйте настройки SMTP вашего почтового провайдера. Обычно они указаны в документации или настройках почты.

