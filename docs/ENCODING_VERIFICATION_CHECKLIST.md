# Чеклист проверки кодировок после деплоя

После выката правок кодировок (UTF-8 для JSON API) пройди по пунктам. Если всё ок — можно переходить к лендингам, боту в ТГ и релизу.

---

## 1. Тарифы и подписка (страница «Компания»)

- [ ] **Планы** — открыть страницу компании, блок тарифа: названия планов (Lite, Team, Pro) и описания отображаются без кракозябр.
- [ ] **Текущая подписка** — дата окончания, название тарифа отображаются нормально.
- [ ] **Кнопка «Оплатить» / «Сменить тариф»** — открывается форма выбора тарифа и периода; текст «1 месяц», «3 месяца» и т.д. читаемый.
- [ ] **Смена тарифа с пересчётом** — если есть активная платная подписка: кнопка «Перейти с пересчётом», сообщения об успехе/ошибке на русском без искажений.

---

## 2. Кабинет owner (продление подписки)

- [ ] **Список компаний** — названия компаний без кракозябр.
- [ ] **Кнопка «Продлить подписку»** — модалка открывается, текст «Оплата получена», периоды (1/3/6/12 месяцев) отображаются корректно.
- [ ] **После продления** — сообщение «Подписка продлена» и дата окончания в норме.

---

## 3. Счета и оплата

- [ ] **Генерация счёта (юрлицо)** — создание счёта, в ответе API (или в UI) название компании, реквизиты без искажений.
- [ ] **PDF счёта** — скачать PDF: «Поставщик», «Покупатель», «Счет на оплату», даты и сумма на русском, кириллица читаемая.
- [ ] **Оплата (СБП/карта)** — после оплаты редирект на страницу компании, подписка обновилась; сообщения об ошибках (если появятся) на русском без кракозябр.

---

## 4. Ошибки и лимиты

- [ ] **429 (лимит запросов)** — при превышении лимита сообщение «Превышен лимит запросов. Попробуйте позже.» отображается нормально.
- [ ] **401/403** — при отсутствии прав текст «Unauthorized» / «Forbidden» или русские подписи без искажений (если есть).

---

## 5. Общее

- [ ] **Контакты и сделки** — имена, комментарии, названия без кракозябр при создании/редактировании и в списках.
- [ ] **Настройки компании** — название компании, ИНН, блоки интеграций: весь русский текст читаемый.

---

## Что сделано в коде

- Добавлен хелпер `lib/json-response.ts`: все ответы через него отправляются с заголовком `Content-Type: application/json; charset=utf-8`.
- Переведены на этот хелпер:  
  `api/billing/plans`, `api/billing/subscription`, `api/billing/invoice/generate`, `api/billing/payment`, `api/billing/change-plan`, `api/admin/extend-subscription`.
- В middleware для ответа 429 добавлен заголовок `Content-Type: application/json; charset=utf-8`.

Если по чеклисту всё ок — кодировки в порядке, можно заниматься лендингами, ботом и релизом.
