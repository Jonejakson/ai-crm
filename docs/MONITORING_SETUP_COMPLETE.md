# üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## ‚úÖ –ß—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

1. **Health Check Endpoint** - `/api/health`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ S3 (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

2. **Metrics Endpoint** - `/api/health/metrics`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
   - Uptime –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î

3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - `lib/logger.ts`
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Sentry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
   - –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

4. **–°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** - `scripts/monitor-logs.sh`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ health check
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker
   - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
cd /opt/flamecrm
chmod +x scripts/monitor-logs.sh

# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
echo "*/5 * * * * /opt/flamecrm/scripts/monitor-logs.sh >> /opt/flamecrm/logs/monitor.log 2>&1" | crontab -
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –í–∞—Ä–∏–∞–Ω—Ç A: Overseer (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://overseer.observer
2. –î–æ–±–∞–≤—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä:
   - URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/api/health`
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª: 5 –º–∏–Ω—É—Ç
   - –¢–∏–ø: HTTP GET
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (email, Telegram)

#### –í–∞—Ä–∏–∞–Ω—Ç B: UptimeRobot (–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://uptimerobot.com
2. –î–æ–±–∞–≤—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä:
   - URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/api/health`
   - –¢–∏–ø: HTTP(s)
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª: 5 –º–∏–Ω—É—Ç
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø–æ email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```env
ALERT_EMAIL=–≤–∞—à-email@example.com
```

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ mail —É—Ç–∏–ª–∏—Ç—É:
```bash
apt-get install -y mailutils
```

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ health check

```bash
curl http://localhost:3000/api/health
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "status": "healthy",
  "timestamp": "2025-12-30T07:00:00.000Z",
  "uptime": 3600,
  "checks": {
    "database": {
      "status": "ok",
      "responseTime": 15
    },
    "encryption": {
      "status": "ok"
    },
    "s3": {
      "status": "ok"
    },
    "memory": {
      "status": "ok",
      "usage": 45
    }
  },
  "metrics": {
    "memoryUsage": 128,
    "memoryTotal": 512
  },
  "version": "0.1.0",
  "environment": "production"
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫

```bash
curl http://localhost:3000/api/health/metrics
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
tail -f /opt/flamecrm/logs/monitor.log
tail -f /opt/flamecrm/logs/error.log
```

## üîç –ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è

1. **Health Check** - –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
3. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** - –Ω–∞–ª–∏—á–∏–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å ENCRYPTION_KEY
4. **S3** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
5. **–ü–∞–º—è—Ç—å** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ heap –ø–∞–º—è—Ç–∏
6. **–î–∏—Å–∫** - —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
7. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** - —Å—Ç–∞—Ç—É—Å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
8. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏** - –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üö® –ê–ª–µ—Ä—Ç—ã

–ê–ª–µ—Ä—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏:
- Health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç unhealthy (503)
- Health check –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –î–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 90%
- –ü–∞–º—è—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 95%
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã
- –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - Overseer –∏–ª–∏ UptimeRobot
2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ** - –º–∏–Ω–∏–º—É–º —Ä–∞–∑ –≤ –¥–µ–Ω—å
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã** - —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å—Ä–∞–∑—É
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Ç—Ä–µ–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- Health Check: `/api/health`
- Metrics: `/api/health/metrics`
- –õ–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: `/opt/flamecrm/logs/monitor.log`
- –õ–æ–≥–∏ –æ—à–∏–±–æ–∫: `/opt/flamecrm/logs/error.log`

