# Flame CRM

CRM для управления сделками, контактами и задачами. Next.js 16, Prisma, PostgreSQL.

**Актуальное состояние продукта** — описание по факту на момент обновления README (для маркетинга и продвижения).

---

## Что есть в интерфейсе (меню и разделы)

### Основные разделы (видны в боковом меню)

| Раздел | Описание |
|--------|----------|
| **Дашборд** | Сводка: сделки по воронкам, активность, быстрые действия. Фильтр по пользователю. |
| **Сделки** | Канбан по воронкам, фильтры, теги. Карточка сделки: контакт, этап, сумма, комментарии, счёт. |
| **Клиенты** | Список контактов, поиск, фильтры. Карточка: контакты, сделки, задачи, теги, кастомные поля. |
| **Задачи** | Задачи с привязкой к сделкам/контактам, сроки, статусы. |
| **Календарь** | События (встречи, звонки и т.п.), привязка к контактам и сделкам. Экспорт в ICS. |
| **Аналитика** | Отчёты по сделкам, контактам, задачам, событиям. Период, воронки, экспорт. |
| **Активность** | Лента действий по сделкам, контактам, задачам. |
| **Поддержка** | Тикеты в поддержку: создание, переписка, статусы (для пользователей компании). |

### Разделы только для администратора

| Раздел | Описание |
|--------|----------|
| **Автоматизации** | Правила по триггерам (сделка/контакт/задача/событие) и действиям (задача, письмо, этап, уведомление и др.). Визуальный редактор. |
| **Компания** | Пользователи, роли (admin/user), права по сущностям, лимиты подписки, кастомные поля компании. |
| **Настройки** | Источники сделок, типы сделок, все интеграции (см. ниже). |

---

## Интеграции (настройки, по факту)

- **Источники сделок** — справочник источников, привязка к воронкам.
- **Типы сделок** — типы для классификации сделок.
- **Веб-формы** — создание форм для сайта, приём заявок в CRM (контакт + сделка).
- **Webhook-интеграции** — входящие webhook по URL для приёма данных из внешних систем.
- **Telegram-бот** — приём сообщений в Telegram, создание контактов и сделок.
- **WhatsApp** — интеграция с WhatsApp Business (webhook).
- **Рекламные интеграции** — только **Яндекс.Директ**: webhook для лидов (Турбо-страницы, Call Tracking). Блок Авито убран.
- **МойСклад** — учёт товаров, синхронизация остатков (если включено).
- **Миграция данных** — импорт из amoCRM и Bitrix24.
- **Email-интеграции** — подключение почты для отправки писем из CRM и логов по контактам.

---

## Чего нет в меню (скрыто или не используется)

- **Диалоги** — страница `/dialogs` есть в коде, в боковом меню не выводится.
- **Чат** — страница `/chat` есть в коде, в меню не выводится.
- **AI-ассистент** — в продукте отдельного раздела с AI-помощником в интерфейсе нет.

---

## Подписка и биллинг

- Тарифы и лимиты (пользователи, контакты, воронки) задаются в админке компании.
- Оплата через ЮKassa (подписка, счета).
- Есть триал, продление, страницы успеха/отмены оплаты.

---

## Технологии

- **Next.js 16** — React, App Router.
- **Prisma** — ORM, миграции.
- **PostgreSQL** — база в продакшене.
- **NextAuth** — авторизация, роли.
- **Tailwind CSS** — стили.
- **PWA** — установка приложения (офлайн-страница).

---

## Установка и запуск

### Переменные окружения

См. `.env.example`. Обязательно: `DATABASE_URL`, `AUTH_SECRET`, `ENCRYPTION_KEY`. Для оплаты — переменные ЮKassa.

### Локальный запуск

```bash
npm install
npx prisma generate
npx prisma migrate dev
npm run dev
```

Открыть [http://localhost:3000](http://localhost:3000).

### Деплой

- **Selectel (Docker):** см. `DEPLOY_AGENT_INSTRUCTIONS.md`, `scripts/safe-deploy.sh`.
- **Миграции в продакшене:** `npx prisma migrate deploy`.

---

## Структура проекта (основное)

```
my-app/
├── app/
│   ├── api/           # API: сделки, контакты, задачи, события, биллинг, интеграции
│   ├── contacts/      # Клиенты
│   ├── deals/         # Сделки
│   ├── tasks/         # Задачи
│   ├── calendar/      # Календарь
│   ├── analytics/     # Аналитика
│   ├── activity/      # Активность
│   ├── support/       # Поддержка (тикеты)
│   ├── automations/   # Автоматизации (admin)
│   ├── company/       # Компания: пользователи, настройки (admin)
│   ├── settings/      # Настройки: источники, типы, интеграции
│   ├── billing/       # Успех/отмена оплаты
│   └── ...
├── components/
├── lib/
├── prisma/
└── public/
```

---

## Для маркетинга и продвижения

Использовать этот README как источник правды о возможностях продукта: не упоминать в рекламе и на сайте блок «Диалоги», «Чат» и «AI-ассистент» как основные фичи, если они не выводятся в меню. Акцент: сделки, контакты, задачи, календарь, аналитика, автоматизации, веб-формы, Telegram/WhatsApp, Яндекс.Директ, МойСклад, миграция из amoCRM/Bitrix24, подписка и биллинг.
